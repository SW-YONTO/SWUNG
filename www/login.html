<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SWUNG - Login</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="js/config.js"></script>
  <style>
    .auth-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      background: radial-gradient(circle at top right, #1f1f2e, #0a0a0f);
    }
    
    .auth-card {
      background: linear-gradient(145deg, rgba(30,30,30,0.9), rgba(15,15,15,0.95));
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 24px;
      padding: 32px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    
    .auth-header {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .logo { font-size: 48px; margin-bottom: 16px; }
    
    .auth-title {
      color: #fff;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .auth-subtitle {
      color: rgba(255,255,255,0.5);
      font-size: 14px;
    }
    
    .github-btn {
      width: 100%;
      background: #ffffff;
      color: #000;
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      font-family: 'Outfit', sans-serif;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 24px;
    }
    
    .github-btn:hover {
      background: #f0f0f0;
      transform: translateY(-2px);
    }
    
    .github-btn:disabled {
      opacity: 0.7;
      cursor: wait;
    }
    
    .github-btn svg { width: 24px; height: 24px; }
    
    .device-code-box {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      margin-top: 24px;
    }
    
    .device-code-box.hidden { display: none; }
    
    .device-code-label {
      color: rgba(255,255,255,0.6);
      font-size: 12px;
      margin-bottom: 12px;
    }
    
    .device-code {
      font-size: 32px;
      font-weight: 700;
      letter-spacing: 4px;
      color: #60a5fa;
      font-family: monospace;
    }
    
    .device-instructions {
      margin-top: 16px;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      line-height: 1.6;
    }
    
    .device-link {
      color: #60a5fa;
      text-decoration: underline;
    }
    
    .status-msg {
      text-align: center;
      margin-top: 16px;
      font-size: 14px;
      color: rgba(255,255,255,0.6);
    }
    
    .status-msg.error { color: #ff4757; }
    .status-msg.success { color: #4ade80; }
    
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #60a5fa;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="auth-container">
    <div class="auth-card">
      <div class="auth-header">
        <div class="logo">ðŸ§¬</div>
        <div class="auth-title">Welcome to SWUNG</div>
        <div class="auth-subtitle">Voice Scheduling powered by GitHub Copilot</div>
      </div>
      
      <button class="github-btn" id="githubBtn">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
        </svg>
        Login with GitHub
      </button>
      
      <div class="device-code-box hidden" id="deviceCodeBox">
        <div class="device-code-label">Enter this code at GitHub</div>
        <div class="device-code" id="deviceCode">----</div>
        <div class="device-instructions">
          Go to <a href="https://github.com/login/device" target="_blank" class="device-link">github.com/login/device</a><br>
          and enter the code above
        </div>
      </div>
      
      <div class="status-msg" id="statusMsg"></div>
    </div>
  </div>
  
  <script>
    const API_BASE = window.SWUNG_CONFIG?.apiBaseUrl || 'https://swung.onrender.com';
    
    const githubBtn = document.getElementById('githubBtn');
    const deviceCodeBox = document.getElementById('deviceCodeBox');
    const deviceCode = document.getElementById('deviceCode');
    const statusMsg = document.getElementById('statusMsg');
    
    let pollInterval = null;
    
    githubBtn.addEventListener('click', async () => {
      githubBtn.disabled = true;
      githubBtn.innerHTML = '<span class="spinner"></span> Starting...';
      statusMsg.textContent = '';
      
      try {
        const res = await fetch(`${API_BASE}/auth/github/start`, {
            credentials: 'include'
        });
        const data = await res.json();
        
        if (data.success && data.userCode) {
          deviceCodeBox.classList.remove('hidden');
          deviceCode.textContent = data.userCode;
          githubBtn.innerHTML = '<span class="spinner"></span> Waiting for authorization...';
          
          // Start polling for completion
          pollInterval = setInterval(checkAuthStatus, 2000);
        } else {
          throw new Error(data.error || 'Failed to start auth');
        }
      } catch (err) {
        statusMsg.textContent = err.message;
        statusMsg.className = 'status-msg error';
        githubBtn.disabled = false;
        githubBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg> Login with GitHub';
      }
    });
    
    async function checkAuthStatus() {
      try {
        const res = await fetch(`${API_BASE}/auth/github/status`, {
            credentials: 'include'
        });
        const data = await res.json();
        
        if (data.status === 'complete') {
          clearInterval(pollInterval);
          statusMsg.textContent = 'Success! Redirecting...';
          statusMsg.className = 'status-msg success';
          
          window.location.href = 'index.html';
        } else if (data.status === 'error') {
          clearInterval(pollInterval);
          statusMsg.textContent = data.error || 'Authorization failed';
          statusMsg.className = 'status-msg error';
          githubBtn.disabled = false;
          githubBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg> Try Again';
        }
      } catch (err) {
        console.error('Status check failed:', err);
      }
    }
  </script>
</body>
</html>
