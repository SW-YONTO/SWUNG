<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
  <title>SWUNG - Voice Scheduler</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <!-- Modular CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <script src="js/theme.js"></script>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/chat.css">
  <link rel="stylesheet" href="css/event-card.css">
  <link rel="stylesheet" href="css/event-modal.css">
  <link rel="stylesheet" href="css/settings.css">
  <!-- API Config -->
  <script src="js/config.js"></script>
</head>
<body>
  
  <div class="chat-wrapper">
    <!-- Top Floating Header (Pill Shape) -->
    <div class="floating-header">
      <div class="header-pill">
        <a href="calendar.html" class="icon-btn" aria-label="Calendar">
          <i class="ph ph-calendar-blank"></i>
        </a>
        <a href="todos.html" class="icon-btn" aria-label="Todos">
          <i class="ph ph-check-square"></i>
        </a>
      </div>
    <div class="header-status">
        <a href="settings.html" class="user-icon-btn" aria-label="Settings">
          <i class="ph ph-user"></i>
        </a>
      </div>
    </div>


    <!-- Chat Area -->
    <div id="chat-container" class="chat-container">
      <div class="message bot">
        <div class="message-content">
          <p>Hello! I'm SWUNG.</p>
        </div>
      </div>
      <!-- Event cards are rendered here via JS -->
    </div>

    <!-- Bottom Input Area -->
    <div class="input-area">
      <!-- Left Actions -->
      <div class="input-actions-left">
        <div id="default-left-actions" class="left-action-group">
          <button id="camera-btn" class="action-btn">
            <i class="ph ph-camera"></i>
          </button>
          <button id="image-btn" class="action-btn">
            <i class="ph ph-image"></i>
          </button>
        </div>
        <button id="record-delete-btn" class="action-btn delete-btn hidden">
          <i class="ph ph-trash"></i>
        </button>
      </div>

      <!-- Hidden File Inputs -->
      <input type="file" id="file-input-camera" accept="image/*" capture="environment" class="hidden">
      <input type="file" id="file-input-gallery" accept="image/*" multiple class="hidden">

      <!-- Image Preview Container -->
      <div id="image-preview-container" class="image-preview-container hidden"></div>

      <!-- Text Input -->
      <div class="input-wrapper">
        <input type="text" id="chat-input" placeholder="Message SWUNG" autocomplete="off">
        
        <!-- Voice Visualizer (Hidden) -->
        <div id="voice-visualizer" class="voice-visualizer hidden">
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
        </div>
        
        <!-- Processing State (Hidden) -->
        <div id="processing-state" class="processing-state hidden">
          <i class="ph ph-spinner ph-spin"></i>
          <span>Processing...</span>
        </div>
      </div>
      
      <!-- Right Action (Mic/Send) -->
      <div class="input-actions-right">
        <button id="mic-btn" class="mic-btn">
          <i class="ph ph-microphone "></i>
        </button>
        <!-- Send button hidden by default, shown when typing -->
        <button id="send-btn" class="send-btn hidden">
        <i class="ph ph-paper-plane-tilt"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Event Modal Container -->
  <div id="event-modal-container"></div>

  <!-- Notification Container -->
  <div id="notification-container"></div>

  <!-- Socket.IO from CDN (for mobile) -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  
  <!-- Capacitor for native features -->
  <script src="https://unpkg.com/@capacitor/core@latest/dist/capacitor.js"></script>
  <script src="https://unpkg.com/@capacitor/push-notifications@latest/dist/plugin.js"></script>
  
  <script src="js/socket-mobile.js"></script>
  <script src="js/event-modal.js"></script>
  <script src="js/chat-mobile.js"></script>
  
  <!-- Native Push Notifications -->
  <script type="module">
    // Initialize native push notifications
    async function initNativePush() {
      if (!window.Capacitor?.isNativePlatform()) {
        console.log('Not on native platform, skipping native push');
        return;
      }
      
      const { PushNotifications } = window.Capacitor.Plugins;
      if (!PushNotifications) return;
      
      const permission = await PushNotifications.requestPermissions();
      if (permission.receive !== 'granted') {
        console.log('Push permission denied');
        return;
      }
      
      await PushNotifications.register();
      
      PushNotifications.addListener('registration', async (token) => {
        console.log('FCM Token:', token.value);
        // Send token to server
        try {
          await fetch(`${window.SWUNG_CONFIG.apiBaseUrl}/api/notifications/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ token: token.value, platform: 'android' })
          });
        } catch (e) {
          console.error('Token registration failed:', e);
        }
      });
      
      PushNotifications.addListener('pushNotificationReceived', (notification) => {
        console.log('Push received:', notification);
        // Show notification in UI
        alert(notification.title + ': ' + notification.body);
      });
    }
    
    document.addEventListener('DOMContentLoaded', initNativePush);
  </script>
</body>
</html>
